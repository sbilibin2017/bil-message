@startuml
actor Sender as User1
actor Recipient as User2
participant "Client Sender" as Client1
participant "Server" as Server
participant "Client Recipient" as Client2
database "Messages DB" as DB
database "Message Keys DB" as KeysDB

User1 -> Client1 : Вводит текст сообщения
Client1 -> Client1 : Генерирует симметрический ключ
Client1 -> Client1 : Шифрует сообщение симметрическим ключом
Client1 -> Client1 : Шифрует ключ публичным ключом получателя
Client1 -> Server : Отправка зашифрованного сообщения и зашифрованного ключа
Server -> DB : Сохраняет зашифрованное сообщение
Server -> KeysDB : Сохраняет зашифрованный ключ для получателя
Server -> Client2 : Уведомление о новом сообщении
Client2 -> Client2 : Расшифровывает симметрический ключ приватным ключом
Client2 -> Client2 : Расшифровывает сообщение
Client2 -> User2 : Отображает текст сообщения
Server -> Client1 : Подтверждение успешной отправки
@enduml
