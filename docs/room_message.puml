@startuml
title Вход в комнату и обмен сообщениями через WebSocket

actor Client
participant Server

Client -> Client: Ввод room_uuid
Client -> Client: Подготовка JWT

Client -> Server: WS подключение к /ws/{room_uuid} с JWT

Server -> Server: Проверка JWT
Server -> Server: Проверка, что пользователь является участником комнаты
Server --> Client: Подтверждение подключения

Client -> Client: Ввод текста сообщения
Client -> Client: Шифрование текста с ключом комнаты (E2EE)

Client -> Server: Отправка ciphertext через WS

Server -> Server: Проверка, что пользователь в комнате
Server -> Server: Рассылка ciphertext всем участникам комнаты (broadcast)
Server --> Client: Получение ciphertext от других участников

Client -> Client: Расшифровка сообщения с приватным ключом и ключом комнаты

@enduml
