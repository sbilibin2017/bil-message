@startuml
actor User
participant "Web Client" as Client
participant "HTTP Server" as Server
participant "JWT Parser" as JWT
database "In-memory Rooms" as Rooms

User -> Client : Вводит сообщение
Client -> Server : WebSocket connect with JWT
Server -> JWT : GetFromRequest()
JWT --> Server : token
Server -> JWT : Parse(token)
JWT --> Server : TokenPayload {userUUID, deviceUUID}

Server -> Rooms : Добавляет пользователя в комнату
Rooms --> Server : Подтверждение

User -> Client : Отправка сообщения
Client -> Server : WS send(JSON)
Server -> Rooms : Получить участников комнаты
Server -> Rooms : Рассылка сообщения всем кроме отправителя
Rooms --> Server : Подтверждение

User -> Client : Закрытие соединения
Client -> Server : WS close
Server -> Rooms : Удаляет пользователя из комнаты
@enduml