# bil-message

## Описание

Это безопасный мессенджер с поддержкой личных и групповых чатов, обеспечивающий сквозное (End-to-End) шифрование сообщений. Основная цель проекта — создать надёжную платформу для обмена сообщениями между пользователями, где все данные защищены от постороннего доступа, включая сервер.  

---

## Цель

Обеспечить безопасное хранение и передачу сообщений между двумя пользователями и в группе пользователей

---

## Задачи

1. Регистрация и управление пользователями.
2. Личные чаты между двумя пользователями.
3. Групповые чаты с множеством участников.
4. Отправка и получение зашифрованных сообщений.
5. Управление E2E ключами для групповых чатов.
6. Разделение чатов по типам (личный, групповой) для удобной организации.

---

## Архитектура

- **Backend**: обеспечивает хранение пользователей, чатов, сообщений и ключей, а также управление связями между ними.
- **База данных**: реляционная структура с таблицами `users`, `chat_types`, `chats`, `chat_members`, `messages` и `group_keys`, обеспечивающими целостность данных и поддержку сквозного шифрования.
- **E2E шифрование**: каждый пользователь имеет публичный и приватный ключи; групповые чаты используют индивидуальные зашифрованные ключи для каждого участника.

---

## Целевая аудитория
- Пользователи, которым важна приватность переписки.
- Команды и компании, нуждающиеся в безопасной платформе для общения.
- Разработчики, заинтересованные в интеграции безопасного обмена сообщениями в свои приложения.

---

## Модель шифрования (RSA + симметричные ключи)

### Принцип работы
1. У каждого пользователя есть пара RSA-ключей:
   - `public_key` — хранится на сервере (доступен всем для шифрования).  
   - `private_key` — хранится только на устройстве пользователя (никогда не передается).  

2. При отправке сообщения:
   - Генерируется случайный **симметрический ключ** (AES-256 или ChaCha20).  
   - Сообщение шифруется этим симметрическим ключом.  
   - Симметрический ключ шифруется публичным RSA-ключом получателя.  

3. При получении сообщения:
   - Клиент расшифровывает симметрический ключ приватным RSA-ключом.  
   - Этим ключом расшифровывает сообщение.  

4. Для групповых чатов:
   - Для каждого участника генерируется своя версия зашифрованного симметрического ключа.  
   - В таблице `message_keys` хранится одна запись на каждого получателя.  

---

## Агрегация непрочитанных сообщений

Для удобства пользователя система поддерживает **механизм сбора и краткой сводки непрочитанных сообщений**.  

- В таблице `message_reads` хранится информация, какие сообщения были прочитаны конкретным пользователем.  
- При входе в приложение сервер формирует список непрочитанных сообщений для каждого чата.  
- Для больших объёмов сообщений используется **интеграция с ChatGPT**:  
  - Все непрочитанные сообщения по каждому чату агрегируются.  
  - Модель формирует краткий конспект ("о чём был разговор, что важно, какие действия ожидаются").  
- Пользователь может получить либо список всех непрочитанных сообщений, либо **сводку по каждому чату**.  

Таким образом, при большом потоке сообщений пользователь может быстро ориентироваться в том, что произошло, даже если он не читал переписку по каждому сообщению.

---

## Диаграмма базы данных

![Диаграмма базы данных](docs/db.png)

## Регистрация пользователя

![Диаграмма регистрации пользователя](docs/register.png)

## Регистрация устрйоства

![Диаграмма регистрации устройства](docs/device.png)

## Вход в аккаунт пользователя

![Диаграмма входа в аккаунт пользователя](docs/login.png)

## Создание чата

![Диаграмма создания чата](docs/chat_create.png)

## Добавление участника чата

![Диаграмма добавления участника чата](docs/chat_add_member.png)

## Создание websocket соединения для общения в чате

![Диаграмма cозданиz websocket соединения для общения в чате](docs/chat_websocket.png)









